---
- name: Patching Centos Linux System
  hosts: all
  ignore_errors: yes

  tasks:
   - name: Update all packages on the server
     yum:
      name: '*'
      state: latest

   - name: Reboot a slow machine that might have lots of updates to apply
     shell: sleep 10 && /sbin/shutdown -r now
     async: 300
     poll: 0
     become: true

   - name: waiting for server booting up
     local_action: wait_for
     args:
       host: all
       port: 22
       delay: 30
       timeout: 600
       state: started
     become: false
